# LearningLab Feature Contract - mBot RuVector
# Educational system for teaching AI concepts through hands-on experiments

contract_meta:
  id: feature_learninglab
  version: 1
  created_from_spec: "docs/PRD.md"
  covers_reqs:
    - ARCH-LEARN-001
    - ARCH-LEARN-002
    - ARCH-LEARN-003
    - ARCH-LEARN-004
    - LEARN-001
    - LEARN-002
    - LEARN-003
    - LEARN-004
  owner: "mbot-ruvector-team"

llm_policy:
  enforce: true
  llm_may_modify_non_negotiables: false
  override_phrase: "override_contract: feature_learninglab"

rules:
  non_negotiable:
    # Architecture Requirements
    - id: ARCH-LEARN-001
      title: "LearningLab must be companion-only (not embedded)"
      rationale: "Educational features need display/UI that ESP32 cannot provide"
      scope:
        - "crates/mbot-embedded/**/*.rs"
      behavior:
        forbidden_patterns:
          - pattern: /learninglab|reflex_lab|experiment/i
            message: "LearningLab features must not be in embedded crate"

    - id: ARCH-LEARN-002
      title: "Experiment data must be serializable"
      rationale: "Support saving/loading experiment sessions"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        required_patterns:
          - pattern: /#\[derive\(.*Serialize.*\)\]/
            message: "Experiment data structs must derive Serialize"
          - pattern: /#\[derive\(.*Deserialize.*\)\]/
            message: "Experiment data structs must derive Deserialize"

    - id: ARCH-LEARN-003
      title: "Timing must use monotonic clock"
      rationale: "Reaction time measurements must be accurate"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        forbidden_patterns:
          - pattern: /SystemTime::now/
            message: "Use Instant::now() for timing measurements"
        required_patterns:
          - pattern: /Instant::now\(\)|elapsed\(\)/
            message: "Must use Instant for reaction time measurement"

    - id: ARCH-LEARN-004
      title: "All data visualized must be explainable to a 10-year-old"
      rationale: "Educational content accessibility"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        required_patterns:
          - pattern: /explanation|hint|learning_objective/i
            message: "Educational content must include explanations"
        example_violation: |
          struct ExperimentResult {
              tension_delta: f32,
          }
        example_compliant: |
          struct ExperimentResult {
              tension_delta: f32,
              explanation: String,  // "The robot got 0.3 more nervous!"
          }

    # Feature Requirements - LEARN-003: Reflex Lab
    - id: LEARN-003
      title: "Reflex Lab - Experiment with stimulus to response relationships"
      rationale: "Core learning feature for understanding cause/effect in AI"
      scope:
        - "crates/mbot-companion/src/learninglab/reflex_lab.rs"
      behavior:
        required_patterns:
          - pattern: /StartleResponse|startle/i
            message: "Must implement Startle Response experiment"
          - pattern: /ApproachAvoid|approach.*avoid/i
            message: "Must implement Approach/Avoid experiment"
          - pattern: /RecoveryTime|recovery/i
            message: "Must implement Recovery Time experiment"
          - pattern: /ModeTransition|mode.*transition/i
            message: "Must implement Mode Transition explorer"
          - pattern: /ExperimentStep|step_number/
            message: "Must have step-by-step guided instructions"
          - pattern: /TimingResult|reaction_time|response_time/
            message: "Must measure and display reaction times"
        example_compliant: |
          pub enum ExperimentType {
              StartleResponse,
              ApproachAvoid,
              RecoveryTime,
              ModeTransitions,
          }

          pub struct ExperimentStep {
              pub step_number: u8,
              pub instruction: String,
              pub hint: Option<String>,
          }

    # Invariants
    - id: I-LEARN-020
      title: "Experiment instructions must be age-appropriate"
      rationale: "Target audience is 10+ years old"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        forbidden_patterns:
          - pattern: /algorithm|coefficient|derivative|integral|tensor/i
            message: "Use age-appropriate language (no advanced math terms)"

    - id: I-LEARN-021
      title: "Each experiment must have clear learning objectives"
      rationale: "Educational value requires explicit goals"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        required_patterns:
          - pattern: /learning_objectives|LearningObjective/
            message: "Experiments must define learning objectives"

    - id: I-LEARN-022
      title: "Observations must correlate with actual robot state"
      rationale: "Accuracy is essential for learning"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        required_patterns:
          - pattern: /HomeostasisState|tension|coherence/
            message: "Must use actual robot homeostasis state"

    - id: I-LEARN-023
      title: "Experiments must be completable without external help"
      rationale: "Self-guided learning"
      scope:
        - "crates/mbot-companion/src/learninglab/**/*.rs"
      behavior:
        required_patterns:
          - pattern: /hint|Hint/
            message: "Must provide hints for students who are stuck"

  soft:
    - id: LEARN-010
      title: "Prefer visual feedback over text"
      suggestion: "Use LED colors and motor movements to show state"

    - id: LEARN-011
      title: "Celebrate experiment completion"
      suggestion: "Add celebratory animations when student completes experiment"

compliance_checklist:
  before_editing_files:
    - question: "Adding educational content?"
      if_yes: "Ensure language is appropriate for 10-year-olds (I-LEARN-020)"
    - question: "Adding timing measurement?"
      if_yes: "Use Instant::now(), not SystemTime (ARCH-LEARN-003)"
    - question: "Adding experiment data struct?"
      if_yes: "Derive Serialize/Deserialize (ARCH-LEARN-002)"
    - question: "Adding new experiment type?"
      if_yes: "Include learning_objectives and step-by-step hints"

test_hooks:
  tests:
    - file: "tests/contracts/learninglab_contract.rs"
      description: "Pattern checks for LEARN-001..004"
    - file: "tests/journeys/learninglab_reflex.rs"
      description: "E2E tests for reflex lab experiments"
  tooling:
    e2e_test_file: "tests/e2e/learninglab/reflex-lab.spec.ts"
